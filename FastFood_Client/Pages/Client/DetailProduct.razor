@page "/ProductDetails/{id:guid}"
@using Data.Models.ProductModels
@using FastFood_Client.HttpRepositories.Interfaces
@inject IHttpProductService HttpProductService
@inject NavigationManager NavigationManager
<PageTitle>Chi tiết sản phẩm</PageTitle>

<!-- Breadcrumb Begin -->
<div class="breadcrumb-option">
    <div class="container">
        <div class="row">
            <div class="col-lg-6 col-md-6 col-sm-6">
                <div class="breadcrumb__text">
                    <h2>Chi tiết sản phẩm</h2>
                </div>
            </div>
            <div class="col-lg-6 col-md-6 col-sm-6">
                <div class="breadcrumb__links">
                    <a href="/">Trang chủ</a>
                    <a href="/Shop">Sản phẩm</a>
                    <span>@(Product != null ? Product.ProductName : "N/A")</span>  <!-- Kiểm tra Product trước khi truy cập thuộc tính -->
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Breadcrumb End -->
<!-- Shop Details Section Begin -->
<section class="product-details spad">
    <div class="container">
        <div class="row">
            <div class="col-lg-6">
                <div class="product__details__img">
                    <div class="product__details__big__img">
                        <img class="big_img" src="@(Product != null ? Product.Image : "client/img/shop/details/product-big-1.jpg")" alt="@(Product != null ? Product.ProductName : "Sản phẩm")">  <!-- Kiểm tra Product trước khi truy cập thuộc tính -->
                    </div>
                </div>
            </div>
            <div class="col-lg-6">
                <div class="product__details__text">
                    <div class="product__label">Loại sản phẩm</div>
                    <h4>@(Product != null ? Product.ProductName : "N/A")</h4>  <!-- Kiểm tra Product trước khi truy cập thuộc tính -->
                    <h5>$@(Product != null ? Product.Price.ToString("0.00") : "N/A")</h5>  <!-- Kiểm tra Product trước khi truy cập thuộc tính -->
                    <p>
                        @(Product != null ? Product.Description : "N/A")  <!-- Kiểm tra Product trước khi truy cập thuộc tính -->
                    </p>
                    <ul>
                        <li>Mã sản phẩm: <span>@(Product != null ? Product.Id.ToString() : "N/A")</span></li>  <!-- Kiểm tra Product trước khi truy cập thuộc tính -->
                    </ul>
                    <div class="product__details__option">
                        <div class="quantity">
                            <div class="pro-qty">
                                <input type="text" value="1">
                            </div>
                        </div>
                        <a href="/Cart" class="primary-btn">Thêm vào giỏ</a>
                    </div>
                </div>
            </div>
        </div>
        <div class="product__details__tab">
            <div class="col-lg-12">
                <ul class="nav nav-tabs" role="tablist">
                    <li class="nav-item">
                        <a class="nav-link active" data-toggle="tab" href="#tabs-1" role="tab">Mô tả sản phẩm</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" data-toggle="tab" href="#tabs-2" role="tab">Đánh giá sản phẩm</a>
                    </li>
                </ul>
                <div class="tab-content">
                    <div class="tab-pane active" id="tabs-1" role="tabpanel">
                        <div class="row d-flex justify-content-center">
                            <div class="col-lg-8">
                                <p>
                                    @(Product != null ? Product.Description : "N/A")
                                </p>
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane" id="tabs-2" role="tabpanel">
                        <div class="row mx-auto d-flex justify-content-center">
                            <div class="col-lg-8">
                                <div class="reviews">
                                    <div class="comments-list">
                                        <!-- Hiển thị danh sách đánh giá sản phẩm -->
                                    </div>
                                    <div class="review-form">
                                        <h4 class="title">Viết đánh giá</h4>

                                        <form id="commentForm" class="form-validate">
                                            <div class="form-group">
                                                <div class="text">
                                                    Nhận xét của bạn
                                                    <span class="required" style="color: #f08632;">*</span>
                                                </div>
                                                <textarea class="form-control" id="comment" name="comment" cols="45"
                                                          rows="6" aria-required="true"></textarea>
                                            </div>

                                            <div class="form-group">
                                                <button class="btn btn-primary w-100" type="submit">Bình luận</button>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>
</section>
<!-- Shop Details Section End -->
<!-- Related Products Section Begin -->
<section class="related-products spad">
    <div class="container">
        <div class="row">
            <div class="col-lg-12 text-center">
                <div class="section-title">
                    <h2>Sản phẩm liên quan</h2>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="related__products__slider owl-carousel">
                @if (RelatedProducts != null)
                {
                    @foreach (var relatedProduct in RelatedProducts)
                    {
                        <div class="col-lg-3">
                            <div class="product__item">
                                <div class="product__item__pic set-bg">
                                    <a href="@($"ProductDetails/{relatedProduct.Id}")">
                                        <img src="@relatedProduct.Image" />
                                    </a>
                                    <div class="product__label">
                                        <span>@relatedProduct.ProductName</span>
                                    </div>
                                </div>
                                <div class="product__item__text">
                                    <h6><a href="@($"ProductDetails/{relatedProduct.Id}")">@relatedProduct.ProductName</a></h6>
                                    <div class="product__item__price">$@relatedProduct.Price.ToString("0.00")</div>
                                    <div class="cart_add">
                                        <a href="/Cart">Thêm vào giỏ</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    }
                }
                else
                {
                    <div class="col-12 text-center">
                        <p>Đang tải sản phẩm liên quan...</p>
                    </div>
                }
            </div>
        </div>
    </div>
</section>
<!-- Related Products Section End -->
@code {
    [Parameter] public Guid id { get; set; }

    private ProductForView Product { get; set; }
    private IEnumerable<ProductForView> RelatedProducts { get; set; }

    protected override async Task OnInitializedAsync()
    {
        Product = await HttpProductService.GetProductByIdAsync(id);
        // Lấy sản phẩm cùng loại từ API hoặc logic khác
        RelatedProducts = await HttpProductService.GetAllProductsAsync();
    }

    private void NavigateToProductDetails(Guid productId)
    {
        NavigationManager.NavigateTo($"/ProductDetails/{productId}");
    }
}